(function(){"use strict";var e={8653:function(e,t,n){var o=n(5130),s=n(2522),i=(n(4188),n(6768));const r={id:"app"};function a(e,t){const n=(0,i.g2)("router-view");return(0,i.uX)(),(0,i.CE)("div",r,[(0,i.bF)(n)])}var c=n(1241);const l={},d=(0,c.A)(l,[["render",a]]);var u=d,p=n(4373),m=n(7477),h=n(782);const f=(0,h.y$)({state(){return{isLoggedIn:!1}},mutations:{SET_LOGGED_IN(e,t){e.isLoggedIn=t},login(e){e.isLoggedIn=!0},logout(e){e.isLoggedIn=!1}},actions:{login({commit:e}){e("login")},logout({commit:e}){e("logout")}},getters:{isLoggedIn:e=>e.isLoggedIn}});var g=f,v=n(1387),y=n(4232);const b=e=>((0,i.Qi)("data-v-4e5f7839"),e=e(),(0,i.jt)(),e),k=b((()=>(0,i.Lk)("h1",null,"Chat",-1))),E=(0,i.Fv)('<div class="chat-container" data-v-4e5f7839><div class="video-container" data-v-4e5f7839><video id="iv" autoplay data-v-4e5f7839></video><div class="overlay-container" data-v-4e5f7839><video id="iv2" autoplay data-v-4e5f7839></video></div></div></div>',1);function C(e,t,n,o,s,r){const a=(0,i.g2)("el-input"),c=(0,i.g2)("el-button");return(0,i.uX)(),(0,i.CE)("div",null,[k,(0,i.bF)(a,{modelValue:s.socketUrl,"onUpdate:modelValue":t[0]||(t[0]=e=>s.socketUrl=e),placeholder:"Enter socket url"},null,8,["modelValue"]),(0,i.eW)(" 你的id:"+(0,y.v_)(s.id)+" 在线用户:"+(0,y.v_)(s.name_list)+" ",1),(0,i.bF)(a,{modelValue:s.userid,"onUpdate:modelValue":t[1]||(t[1]=e=>s.userid=e),placeholder:"Enter your user id"},null,8,["modelValue"]),(0,i.bF)(c,{type:"primary",onClick:t[2]||(t[2]=e=>r.cn(this.userid))},{default:(0,i.k6)((()=>[(0,i.eW)("Connect")])),_:1}),(0,i.bF)(c,{type:"primary",onClick:r.openVideo},{default:(0,i.k6)((()=>[(0,i.eW)("Open Video")])),_:1},8,["onClick"]),(0,i.bF)(c,{type:"danger",onClick:r.hangUp},{default:(0,i.k6)((()=>[(0,i.eW)("Hang Up")])),_:1},8,["onClick"]),E])}n(4114);var S={name:"ChatView",data(){return{socket:null,pc:null,localStream:null,userid:"",socketUrl:"",id:"",name_list:[]}},methods:{InitSocket(){let e=this.$route.query.user;this.socketUrl="wss://192.168.3.3:8099/"+e;let t=new WebSocket(this.socketUrl);this.socket=t,this.socket.onclose=e=>console.log("Connection closed:",e.code),this.socket.onopen=()=>console.log("Connection established"),this.socket.onerror=e=>console.error("Socket error:",e),this.socket.onmessage=async t=>{const n=JSON.parse(t.data),{type:o,userId:s}=n;if(!s||s===e.toString())try{if("offer"===o){if(this.pc)return void console.error("PeerConnection already exists!");this.pc=this.InitPeerConnection(e);const t=new RTCSessionDescription(n);await this.pc.setRemoteDescription(t);const o=await this.pc.createAnswer();await this.pc.setLocalDescription(o),this.socket.send(JSON.stringify(o))}else if("answer"===o){if(!this.pc)return void console.error("PeerConnection does not exist!");const e=new RTCSessionDescription(n);await this.pc.setRemoteDescription(e)}else if("candidate"===o){const e=new RTCIceCandidate({sdpMLineIndex:n.sdpMLineIndex,sdpMid:n.sdpMid,candidate:n.candidate});await this.pc.addIceCandidate(e)}else"hangup"===o?(this.hangUp(),console.log("Received hangup message, call ended.")):"name_list"===o&&(this.id=n.your_id,this.name_list=n.data)}catch(i){console.error("Error handling message:",i)}}},InitPeerConnection(e){let t=null;try{t=window.webkitRTCPeerConnection?new window.webkitRTCPeerConnection:new RTCPeerConnection}catch(n){return console.error("Connection failed:",n.message),null}return t.onicecandidate=t=>{if(t.candidate){const n={type:"candidate",userId:e,sdpMid:t.candidate.sdpMid,sdpMLineIndex:t.candidate.sdpMLineIndex,candidate:t.candidate.candidate};this.socket.send(JSON.stringify(n))}},this.localStream&&this.localStream.getTracks().forEach((e=>{t.addTrack(e,this.localStream)})),t.ontrack=e=>{const t=e.streams[0];document.getElementById("iv2").srcObject=t},t},cn(e){this.pc=this.InitPeerConnection(e),this.pc.createOffer().then((t=>{const n={type:"offer",sdp:t.sdp,userId:e};return this.pc.setLocalDescription(t).then((()=>{this.socket.send(JSON.stringify(n))}))})).catch((e=>console.error("Create offer failed:",e)))},openVideo(){navigator.mediaDevices.getUserMedia({video:!0,audio:!0}).then((e=>{this.localStream=e;const t=document.getElementById("iv");t.srcObject=e,t.play()})).catch((e=>{console.error("Error accessing media devices.",e)}))},hangUp(){if(this.pc){const e=JSON.stringify({type:"hangup",userId:this.$route.query.touser});this.socket.send(e),this.pc.close(),this.pc=null,this.localStream&&(this.localStream.getTracks().forEach((e=>e.stop())),this.localStream=null),document.getElementById("iv").srcObject=null,document.getElementById("iv2").srcObject=null,console.log("Call ended"),this.$router.push({name:"demo",query:{user:this.$route.query.user}})}else console.log("No active connection to hang up")}},mounted(){function e(){this.socket.send(`CLOSE||${this.$route.query.user}`)}this.openVideo(),this.InitSocket(),window.addEventListener("beforeunload",e),console.log(this.$route.query.touser),this.$route.query.touser&&setTimeout((()=>{this.cn(this.$route.query.touser)}),1e3)},beforeUnmount(){this.pc&&(this.pc.close(),this.pc=null),this.localStream&&(this.localStream.getTracks().forEach((e=>e.stop())),this.localStream=null),this.socket&&(this.socket.close(),this.socket=null)}};const L=(0,c.A)(S,[["render",C],["__scopeId","data-v-4e5f7839"]]);var I=L;const w=(0,i.Fv)('<h1 data-v-9b3e6622>WebSocket Chat</h1><div class="container my-5" data-v-9b3e6622><div id="board" class="row" data-v-9b3e6622></div></div><div id="timeDisplay" data-v-9b3e6622></div><div style="display:flex;" data-v-9b3e6622><input type="text" id="nameInput" placeholder="Set your name..." data-v-9b3e6622><button id="setName" data-v-9b3e6622>Set Name</button></div><div id="messages" data-v-9b3e6622></div><div style="display:flex;" data-v-9b3e6622><input type="text" id="messageInput" placeholder="Type your message here..." data-v-9b3e6622><button id="sendMessage" data-v-9b3e6622>Send</button></div><button id="Match" data-v-9b3e6622>Match</button><button id="Close" data-v-9b3e6622>Close Match</button><div id="userList" class="user-list" data-v-9b3e6622></div>',9);function $(e,t,n,o,s,i){return w}var O={name:"DemoView",data(){return{html:"<h1>Hello World</h1>",ws:null,Username:null,gameInfo:null,timerId:null,board:null,canvas:null,ctx:null,piece:null}},methods:{},mounted(){let e;e=this.$route.query.user?this.$route.query.user:Math.round(1e3*Math.random());const t="wss://192.168.3.3:8099/"+e,n=new WebSocket(t);let o,s,i="";const r=document.createElement("canvas");r.id="ls",r.width=450,r.height=450;const a=r.getContext("2d"),c=15,l=r.width/c;a.strokeStyle="#000",a.lineWidth=1;let d=Array(c).fill(null).map((()=>Array(c).fill(null))),u=!0;const p=document.getElementById("timeDisplay");let m=0;function h(e){n.send(`CALL||${e}||${i}`)}function f(){const e=Math.floor(m/60).toString().padStart(2,"0"),t=(m%60).toString().padStart(2,"0");p.textContent=`正在匹配 ${e}:${t}`,m++}function g(){document.body.appendChild(r);for(let e=0;e<=c;e++)a.beginPath(),a.moveTo(0,e*l),a.lineTo(r.width,e*l),a.stroke(),a.beginPath(),a.moveTo(e*l,0),a.lineTo(e*l,r.height),a.stroke()}function v(e,t,n){a.beginPath();const o=e*l+l/2,s=t*l+l/2;a.arc(o,s,l/2*.4,0,2*Math.PI),a.fillStyle=n,a.fill(),a.stroke(),"black"===n&&(u=!1)}function y(e){const t=s.replace(/'/g,'"'),o=JSON.parse(t);if(o["play1"]===i){const o=r.getBoundingClientRect(),s=Math.floor((e.clientX-o.left)/l),p=Math.floor((e.clientY-o.top)/l);if(d[p][s])return;d[p][s]=u?"black":"white",v(s,p,u?"black":"white");const m={type:"move",x:s,y:p,color:u?"black":"white"};if(n.send(`move||${JSON.stringify(m)}||${i}||${t}`),n.send(`update||${t}`),b(s,p)){d=Array(c).fill(null).map((()=>Array(c).fill(null))),a.clearRect(0,0,r.width,r.height);const e=document.getElementById("ls");e&&(e.parentNode.removeChild(e),n.send(`GAME_OVER||${t}||${i}`))}else u=!u}else alert("现在不是你的回合")}function b(e,t){const n=d[t][e];return k(e,t,1,0,n)||k(e,t,0,1,n)||k(e,t,1,1,n)||k(e,t,1,-1,n)}function k(e,t,n,o,s){let i=1;for(let r=1;r<5;r++){const a=e+r*n,l=t+r*o;if(!(a>=0&&l>=0&&a<c&&l<c&&d[l][a]===s))break;i++}for(let r=1;r<5;r++){const a=e-r*n,l=t-r*o;if(!(a>=0&&l>=0&&a<c&&l<c&&d[l][a]===s))break;i++}return i>=5}function E(){n.send(`CLOSE||${e}`)}n.onopen=()=>{console.log("Connected to WebSocket server"),n.send("LIST")},n.onmessage=async t=>{const a=t.data.split("||");if(a.length<2)console.warn("Unexpected data format:",t.data);else if("NAME_SET"===a[0])this.$message.success("Name set to:"+a[1]),i=a[1];else if("ERROR"===a[0])this.$message.error(a[1]);else if("MESSAGE"===a[0]){const[,e,t]=a,n=document.getElementById("messages"),o=document.createElement("div");o.textContent=`来自 ${e}的私聊消息: ${t}`,n.appendChild(o),n.scrollTop=n.scrollHeight}else if("LIST"===a[0]){const e=document.getElementById("userList");e.innerHTML="";const t=a[1].split(",");t.forEach((t=>{const[n,o]=t.split(":"),s=document.createElement("div");s.className="user";const i=document.createElement("span");i.textContent=n+":"+o,s.appendChild(i);const r=document.createElement("button");r.textContent="Video Call",r.className="video-call-button",r.onclick=()=>{h(n)},s.appendChild(r),s.onclick=()=>{const e=document.getElementById("messageInput");e.placeholder=`Message to ${o}`,e.setAttribute("data-recipient",n)},e.appendChild(s)}))}else if("ALL"===a[0]){const[,e,t]=a,n=document.getElementById("messages"),o=document.createElement("div");o.textContent=`来自 ${e} 的全部消息: ${t}`,n.appendChild(o),n.scrollTop=n.scrollHeight}else if("GAME"===a[0]){const[,e,t,n]=a;switch(e){case"正在匹配":o=setInterval(f,1e3);break;case"匹配成功":{clearInterval(o),this.$message.success("匹配成功 "+t),s=n;const e=document.getElementById("timeDisplay");e.textContent="",g(),r.addEventListener("click",y);break}case"gameData":s=n;break;case"OVER":{const[,,e]=a;this.$message.success(`游戏结束,获胜者为 ${e}`);const t=document.getElementById("ls");t&&t.parentNode.removeChild(t);break}}}else if("MOVE"===a[0]){const[,e]=a,t=JSON.parse(e);console.log(t);const n=t["x"],o=t["y"],s=t["color"];d[o][n]=s,v(n,o,s)}else if("CALL"===a[0]){const[,t]=a,o=await this.$confirm(`${t} 请求视频通话`);o?(n.send(`CALL||ACCEPT||${t}||${i}`),this.$router.push({name:"chat",query:{user:e}})):this.$message.error("视频通话请求已拒绝")}else if("ACCEPT_CALL"===a[0]){const[,t]=a;this.$message.success(`${t} 接受了你的视频通话请求`),setTimeout((()=>{this.$router.push({name:"chat",query:{user:e,touser:t}})}),900)}},n.onclose=()=>{console.log("Disconnected from WebSocket server")},document.getElementById("sendMessage").addEventListener("click",(()=>{const e=document.getElementById("messageInput"),t=e.value,o=e.getAttribute("data-recipient");t&&o?(n.send(`MESSAGE||${o}||${t}`),e.value="",e.setAttribute("data-recipient","")):n.send(`ALL_MESSAGE||${i}||${t}`)})),document.getElementById("setName").addEventListener("click",(()=>{const e=document.getElementById("nameInput"),t=e.value;t&&(n.send(`SET_NAME||${t}`),e.value="",n.send("LIST"))})),document.getElementById("Match").addEventListener("click",(()=>{i?n.send(`GAME||Match||${i}`):this.$message.error("请先设置用户名")})),window.addEventListener("beforeunload",E),document.getElementById("Close").addEventListener("click",(()=>{const e=s.replace(/'/g,'"'),t=JSON.parse(e);t["play1"]===i?n.send(`update||${s}`):this.$message.error("现在不是你的回合")}))},beforeUnmount(){const e=document.getElementById("ls");e&&e.parentNode.removeChild(e)}};const A=(0,c.A)(O,[["render",$],["__scopeId","data-v-9b3e6622"]]);var M=A;const T=e=>((0,i.Qi)("data-v-53e4aed5"),e=e(),(0,i.jt)(),e),_={class:"login-container"},x={class:"login-form"},N=T((()=>(0,i.Lk)("h2",null,"Login",-1))),P={class:"form-group"},U=T((()=>(0,i.Lk)("label",{for:"username"},"Username",-1))),B={class:"form-group"},V=T((()=>(0,i.Lk)("label",{for:"password"},"Password",-1))),R={class:"form-group"},j={class:"form-group"};function q(e,t,n,s,r,a){return(0,i.uX)(),(0,i.CE)("div",_,[(0,i.Lk)("div",x,[N,(0,i.Lk)("div",P,[U,(0,i.bo)((0,i.Lk)("input",{type:"text",id:"username","onUpdate:modelValue":t[0]||(t[0]=e=>r.from.username=e)},null,512),[[o.Jo,r.from.username]])]),(0,i.Lk)("div",B,[V,(0,i.bo)((0,i.Lk)("input",{type:"password",id:"password","onUpdate:modelValue":t[1]||(t[1]=e=>r.from.password=e)},null,512),[[o.Jo,r.from.password]])]),(0,i.Lk)("div",R,[(0,i.Lk)("button",{type:"button",class:"btn btn-primary",onClick:t[2]||(t[2]=e=>a.Login())},"Login")]),(0,i.Lk)("div",j,[(0,i.Lk)("p",null,(0,y.v_)(r.error),1)])])])}const D=p.A.create({baseURL:"https://192.168.3.3:5701"});D.interceptors.request.use((e=>{e.headers["Content-Type"]="application/json;charset=utf-8";const t=localStorage.getItem("user");return t&&(e.headers["token"]=JSON.parse(t).token),e}),(e=>Promise.reject(e))),D.interceptors.response.use((e=>{let t=e.data;return"string"===typeof t&&(t=t?JSON.parse(t):t),t}),(e=>(console.log("err"+e),Promise.reject(e))));var J=D,W={name:"LoginView",props:["show"],data(){return{from:{username:"",password:""},emits:["close-dialog"],error:""}},methods:{Login(){J.post("/login",this.from).then((e=>{if("1"===e.code){this.$message.success("Login success");const e=JSON.stringify(this.from);localStorage.setItem("login_user",e),this.$emit("close-dialog"),this.$router.push("/")}else this.$message.error(e.message)}))}}};const F=(0,c.A)(W,[["render",q],["__scopeId","data-v-53e4aed5"]]);var G=F;const H=[{path:"/",name:"login",component:G},{path:"/chat",name:"chat",component:I},{path:"/demo",name:"demo",component:M},{path:"/file",name:"file",component:File}],X=(0,v.aE)({history:(0,v.LA)(),routes:H});var Q=X;const Y=(0,o.Ef)(u);Y.config.globalProperties.$axios=p.A,Y.config.globalProperties.$baseURL={NODE_ENV:"production",BASE_URL:"/"}.VUE_APP_BASEUA,Y.config.globalProperties.$store=g;for(const[z,K]of Object.entries(m))Y.component(z,K);Y.use(Q),Y.use(g),Y.use(s.A),Y.mount("#app")}},t={};function n(o){var s=t[o];if(void 0!==s)return s.exports;var i=t[o]={exports:{}};return e[o].call(i.exports,i,i.exports,n),i.exports}n.m=e,function(){var e=[];n.O=function(t,o,s,i){if(!o){var r=1/0;for(d=0;d<e.length;d++){o=e[d][0],s=e[d][1],i=e[d][2];for(var a=!0,c=0;c<o.length;c++)(!1&i||r>=i)&&Object.keys(n.O).every((function(e){return n.O[e](o[c])}))?o.splice(c--,1):(a=!1,i<r&&(r=i));if(a){e.splice(d--,1);var l=s();void 0!==l&&(t=l)}}return t}i=i||0;for(var d=e.length;d>0&&e[d-1][2]>i;d--)e[d]=e[d-1];e[d]=[o,s,i]}}(),function(){n.n=function(e){var t=e&&e.__esModule?function(){return e["default"]}:function(){return e};return n.d(t,{a:t}),t}}(),function(){n.d=function(e,t){for(var o in t)n.o(t,o)&&!n.o(e,o)&&Object.defineProperty(e,o,{enumerable:!0,get:t[o]})}}(),function(){n.g=function(){if("object"===typeof globalThis)return globalThis;try{return this||new Function("return this")()}catch(e){if("object"===typeof window)return window}}()}(),function(){n.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)}}(),function(){n.r=function(e){"undefined"!==typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})}}(),function(){var e={524:0};n.O.j=function(t){return 0===e[t]};var t=function(t,o){var s,i,r=o[0],a=o[1],c=o[2],l=0;if(r.some((function(t){return 0!==e[t]}))){for(s in a)n.o(a,s)&&(n.m[s]=a[s]);if(c)var d=c(n)}for(t&&t(o);l<r.length;l++)i=r[l],n.o(e,i)&&e[i]&&e[i][0](),e[i]=0;return n.O(d)},o=self["webpackChunkhsq"]=self["webpackChunkhsq"]||[];o.forEach(t.bind(null,0)),o.push=t.bind(null,o.push.bind(o))}();var o=n.O(void 0,[504],(function(){return n(8653)}));o=n.O(o)})();
//# sourceMappingURL=app.39c72263.js.map